import{t as Nt,_ as Me,o as ee,c as le,f as X,g as Lt,v as Rt,h as $t,n as qe,i as Ft,d as Pt,j as H,k as de,l as ge,b as ne,m as me,w as F,a as P,e as ce,p as pe,q as _e,F as ye,E as Vt,s as qt,u as jt,x as Ut,y as Bt,z as zt,A as Dt}from"./index.9947bbcf.js";var Ht=0;function Wt(u){var L=++Ht;return Nt(u)+L}const Xt=["advlist indent2em anchor autolink code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"],Gt=["searchreplace forecolor backcolor bold italic underline strikethrough alignleft aligncenter alignright outdent indent undo redo subscript superscript","fontsizeselect indent2em hr bullist numlist link image charmap anchor pagebreak code codesample blockquote removeformat fullscreen"];let fe=[];function Yt(){return window.tinymce}const Jt=(u,L)=>{const S=document.getElementById(u),y=L||function(){};if(!S){const w=document.createElement("script");w.src=u,w.id=u,document.body.appendChild(w),fe.push(y),("onload"in w?$:D)(w)}S&&y&&(Yt()?y(null,S):fe.push(y));function $(w){w.onload=function(){this.onerror=null,this.onload=null;for(const _ of fe)_(null,w);fe=null},w.onerror=function(){this.onerror=null,this.onload=null,y(new Error(`Failed to load ${u}`),w)}}function D(w){w.onreadystatechange=function(){if(!(this.readyState!=="complete"&&this.readyState!=="loaded")){this.onreadystatechange=null;for(const _ of fe)_(null,w);fe=null}}}},Kt={name:"Tinymce",props:{id:{type:String,default(){return`vue-tinymce-${+new Date}${(Math.random()*1e3).toFixed(0)}`}},tinymceCDN:{type:String,default:"https://public-web-res-1312176471.cos.ap-guangzhou.myqcloud.com/tinymce-5.10.0/tinymce.min.js"},disabled:{type:Boolean,default:!1},modelValue:{type:String,default:""},toolbar:{type:Array,required:!1,default(){return[]}},fontsizes:{type:String,default:"11px 12px 14px 16px 18px 20px 24px 36px 48px"},menubar:{type:String,default:"file edit insert view format table my1"},height:{type:[Number,String],required:!1,default:360},width:{type:[Number,String],required:!1,default:"auto"},config:{type:Object}},data(){return{hasChange:!1,hasInit:!1,tinymceId:this.id,fullscreen:!1,languageTypeList:{en:"en",zh:"zh_CN",es:"es_MX",ja:"ja"}}},computed:{containerWidth(){const u=this.width;return/^[\d]+(\.[\d]+)?$/.test(u)?`${u}px`:u}},watch:{modelValue(u){!this.hasChange&&this.hasInit&&this.$nextTick(()=>window.tinymce.get(this.tinymceId).setContent(u||""))},disabled(u){window.tinymce&&window.tinymce.get(this.tinymceId)&&window.tinymce.get(this.tinymceId).mode.set(u?"readonly":"design")}},mounted(){this.init()},activated(){window.tinymce&&this.initTinymce()},deactivated(){this.destroyTinymce()},unmounted(){this.destroyTinymce()},methods:{init(){Jt(this.tinymceCDN,u=>{if(this.$emit("loadTinymce",u),u){this.$message.error(u.message);return}this.initTinymce()})},initTinymce(){const u=this;window.tinymce.init({selector:`#${this.tinymceId}`,language:this.languageTypeList.zh,height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar.length>0?this.toolbar:Gt,menubar:this.menubar,fontsize_formats:this.fontsizes,plugins:Xt,readonly:this.disabled,end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,init_instance_callback:L=>{this.$emit("initInstanceCallback",L),u.modelValue&&L.setContent(u.modelValue),u.hasInit=!0,L.on("NodeChange Change KeyUp SetContent",()=>{this.hasChange=!0,this.$emit("update:modelValue",L.getContent())})},setup(L){L.on("FullscreenStateChanged",S=>{u.fullscreen=S.state})},convert_urls:!1,...this.config})},destroyTinymce(){const u=window.tinymce.get(this.tinymceId);this.fullscreen&&u.execCommand("mceFullScreen"),u&&u.destroy()},setContent(u){window.tinymce.get(this.tinymceId).setContent(u)},getContent(){window.tinymce.get(this.tinymceId).getContent()}}},Qt=["id"],Zt={class:"editor-custom-menu-right"};function en(u,L,S,y,$,D){return ee(),le("div",{class:qe(["tinymce-container",{fullscreen:$.fullscreen,"tinymce-container-disabled":S.disabled}]),style:Ft({width:D.containerWidth})},[X("textarea",{id:$.tinymceId,class:"tinymce-textarea"},null,8,Qt),Lt(X("div",Zt,[$t(u.$slots,"menu-right",{},void 0,!0)],512),[[Rt,!S.disabled]])],6)}var tn=Me(Kt,[["render",en],["__scopeId","data-v-39476db6"]]);const nn=Pt({components:{tinymce:tn},props:{modelValue:{type:String,defualt:""},id:{type:String,default:"tinymce-formula"},operatorList:{type:Array,default:()=>[]},functionList:{type:Array,default:()=>[]},color:{type:String,default:"#1C88E5"}},setup(u,{emit:L}){const S=H(null),y=de(()=>Wt(u.id)),$=H(""),D=H({toolbar:[],plugins:["autoresize"],menubar:[],statusbar:!1,autoresize_bottom_margin:20,autoresize_min_height:100,autoresize_max_height:500,content_style:`p {font-size: 14px} .mention-field{color: ${u.color}}`});let w=!1;const _=(r,m=0)=>{const M=document.createRange();return M.setStart(r,m),M.setEnd(r,m),M},U=()=>{const r=window.tinyMCE.editors[y.value];r.setContent($.value,{noSelection:!0}),ge(()=>{requestAnimationFrame(()=>{const m=r.selection.getEnd();r.selection.setRng(_(m,m.childNodes.length)),r.focus()})}),w=!0},Y=r=>{var I;const m=(I=window.tinyMCE)==null?void 0:I.editors[y.value];if(!m)return;const M=m.getBody(),J=M.textContent;if(u.modelValue===J)return;const O=M.childNodes,V=[],Z=u.operatorList.map(K=>{var Q;return`\\${(Q=K.value)!=null?Q:K}`}).join(""),z=new RegExp(`([${Z}])`),q=new RegExp(`([${Z}])`);O.forEach(K=>{for(let Q=0;Q<K.childNodes.length;Q+=1){const b=K.childNodes[Q],te=b.nodeType===1&&(b==null?void 0:b.getAttribute)?b==null?void 0:b.getAttribute("class"):"",i=b!=null&&b.getAttribute?b==null?void 0:b.getAttribute("data-mce-selected"):"",f=b.textContent;i||(b.nodeType===3?f!==""&&V.push({type:"text",value:f}):te&&te.indexOf("mention-field")!==-1?f!==""&&V.push({type:"field",value:f}):te&&te.indexOf("mention-operator")!==-1?f.split(z).forEach(k=>{k!==""&&(q.test(k)?V.push({type:"operator",value:k}):V.push({type:"text",value:k}))}):V.push({type:"text",value:f}))}}),L("changeHtmlContent",r),L("change",V),L("input:modelValue",J)},A=()=>{window.tinyMCE.editors[y.value].on("change input undo redo",m=>{Y(m)}),w||U()},T=({value:r,type:m,offset:M,offsetIdx:J})=>{const O=window.tinyMCE.editors[y.value];if(m==="operator")M?(O.insertContent(r),G(J)):O.insertContent(r);else if(m==="field")O.insertContent(`<span class="mention-${m}" contenteditable="false">${`#${r}#`}</span>`);else{if(Object.prototype.toString.call(r)==="[object Array]")for(let V=0;V<r.length;V++)O.insertContent(r[V]);else O.insertContent(r);M&&G(J)}A(),O.focus()},G=r=>{const m=window.tinyMCE.editors[y.value],M=m.selection.getRng(),O=M.startOffset-1;m.selection.setRng({startContainer:M.startContainer,startOffset:r!=null?r:O,endContainer:M.startContainer,endOffset:r!=null?r:O})},R=r=>{if(!r)return[];const m=`([${u.operatorList.map(q=>{var I;return`\\${(I=q.value)!=null?I:q}`}).join("|")}|${u.functionList.map(q=>`\\b${q.label}\\b`).join("|")}\\s])`,M=new RegExp(m),J=r.split(M),O=new RegExp(`[${u.operatorList.map(q=>{var I;return`\\${(I=q.value)!=null?I:q}`}).join("")}]`),V=[];let Z=!1,z="";for(let q=0;q<J.length;q=q+1){const I=J[q];I===""||I===void 0||(I.startsWith("#")?(Z=!0,z=I,I.endsWith("#")&&(V.push({type:"field",value:I}),Z=!1,z="")):Z?(z+=I,I.endsWith("#")&&(V.push({type:"field",value:z}),Z=!1,z="")):O.test(I)?V.push({type:"text",value:I}):V.push({type:"text",value:I}))}return V},B=r=>r.map(m=>m.type==="field"?`<span class="mention-field" contenteditable="false">${m.value}</span>`:m.type==="operator"?`<span class="mention-operator">${m.value}</span>`:m.value).join("");return{ztTinymceRef:S,curId:y,content:$,config:D,contentChange:Y,initInstanceCallback:A,insertContent:T,setContent:r=>{$.value=r;const m=R(r),M=B(m);$.value=M,ge(()=>{window.tinyMCE?U():w=!1})}}}});function sn(u,L,S,y,$,D){const w=ne("tinymce");return ee(),me(w,{id:u.curId,ref:"ztTinymceRef",modelValue:u.content,"onUpdate:modelValue":L[0]||(L[0]=_=>u.content=_),config:u.config,height:220,width:"100%",class:"tinymce-formula-main",onInitInstanceCallback:u.initInstanceCallback},null,8,["id","modelValue","config","onInitInstanceCallback"])}var rn=Me(nn,[["render",sn],["__scopeId","data-v-744b47d0"]]);const Ae=u=>(jt("data-v-85990e88"),u=u(),Ut(),u),on=Ae(()=>X("h6",null,"\u5F15\u7528\u5B57\u6BB5",-1)),an=Ae(()=>X("h6",null,"\u8FD0\u7B97\u7B26",-1)),un={class:"rule-row-content"},ln=Ae(()=>X("h6",null,"\u5E38\u7528\u51FD\u6570",-1)),cn={__name:"formula-dialog",props:{request:Object,title:{type:String,title:"\u7F16\u8F91\u516C\u5F0F\u89C4\u5219"}},emits:["onClose"],setup(u,{expose:L,emit:S}){const y=u,$=S,D=H(!1),w=H(!1),_=H({calcExpression:null,expressionContent:"",formulaContent:""}),U=H(),Y=H(null),A=H(-1),T=H(!1),G=H(""),R=H({name:""}),B=H(null),se=/^\s*$/,r=H([]),m=de(()=>{var i,f;return(f=(i=y.request)==null?void 0:i.operatorList)!=null?f:["+","-","*","/","(",")"]}),M=de(()=>{var i,f;return(f=(i=y.request)==null?void 0:i.functionList)!=null?f:[]}),J=de(()=>{const i=[];return r.value.forEach(f=>{f.variableList.forEach(j=>{i.push(j)})}),i}),O=de(()=>{if(G.value)return G.value;let i="\u516C\u5F0F\u672A\u68C0\u9A8C";return A.value===0?i="\u516C\u5F0F\u68C0\u9A8C\u4E0D\u901A\u8FC7":A.value===1&&(i="\u516C\u5F0F\u68C0\u9A8C\u901A\u8FC7"),i}),V=de(()=>{let i="info-color no-check";return A.value===0?i="error-color fail-check":A.value===1&&(i="success-color success-check"),i}),Z=i=>{i.code!==R.value.code&&B.value.insertContent({value:i.name,type:"field"})},z=i=>{typeof i=="string"?B.value.insertContent({value:i,type:"text"}):B.value.insertContent({...i,type:"text"})},q=i=>{B.value.insertContent({...i,type:"function"})},I=i=>{let f="",j="";const k=[];console.log("contendEditChange",i),(i||[]).forEach(C=>{if(C.type==="field"){const oe=C.value.replace(/#/g,""),re=J.value.find(ae=>ae.name===oe);re?j+=re.code:j+=C.value,k.push({...C,value:re?re.code:C.value})}else j+=C.value,k.push(C);f+=C.value}),_.value={expressionContent:f,calcExpression:j.replace(/[\u200B-\u200D\uFEFF\s]/g,""),calcList:k},ge(()=>{A.value=-1,G.value="",U.value.validateField("calcExpression")})},K=()=>(T.value=!0,G.value="",new Promise((i,f)=>{if(se.test(_.value.calcExpression)){f("\u8BF7\u8F93\u5165\u516C\u5F0F\u89C4\u5219"),T.value=!1;return}U.value.validate(j=>{var k;j?y.request.checkRule({...(k=y.request.extraParams)!=null?k:{},calcExpression:_.value.calcExpression,calcList:_.value.calcList,code:R.value.code,name:R.value.name,expressionContent:_.value.expressionContent}).then(C=>{C!=null&&C.success?(i(),A.value=1):(A.value=0,G.value=C.message,f(O.value)),T.value=!1}).catch(C=>{console.log("err",C),A.value=0,T.value=!1,f(O.value)}):(f("\u8BF7\u8F93\u5165\u516C\u5F0F\u89C4\u5219"),T.value=!1)})})),Q=()=>{_.value={},w.value=!1},b=()=>{U.value.validate(i=>{i&&ge(()=>{K().then(()=>{$("change",{..._.value}),Q()}).catch(f=>{console.log("errText",f),Vt.error(f)})})})};return L({open:async i=>{R.value=i,await y.request.queryVariable(R.value).then(f=>{r.value=f}),w.value=!0,_.value={expressionContent:i.expressionContent,calcExpression:i.calcExpression,calcList:i.calcList},Y.value=i.variableType,ge(()=>{A.value=-1,G.value="",U.value.clearValidate();const f=[];i.calcList&&i.calcList.forEach(j=>{if(j.type==="field"){const k=J.value.find(C=>C.code===j.value);k?f.push({type:j.type,value:k.value}):f.push(j)}else f.push(j)}),B.value&&B.value.setContent(i.expressionContent)})}}),(i,f)=>{const j=ne("el-form-item"),k=ne("el-button"),C=ne("el-row"),oe=ne("el-form"),re=ne("el-divider"),ae=ne("el-col"),xe=ne("el-dialog");return ee(),me(xe,{modelValue:w.value,"onUpdate:modelValue":f[1]||(f[1]=d=>w.value=d),title:u.title,width:"780","close-on-click-modal":!1,onClose:Q},{footer:F(()=>[P(C,{class:"dialog-footer",justify:"end"},{default:F(()=>[X("div",null,[P(k,{type:"primary",loading:D.value,onClick:b},{default:F(()=>[ce(" \u786E\u5B9A ")]),_:1},8,["loading"]),P(k,{onClick:Q},{default:F(()=>[ce("\u53D6\u6D88")]),_:1})])]),_:1})]),default:F(()=>[P(C,{class:"rule-main"},{default:F(()=>[P(ae,{span:16,class:"main-left"},{default:F(()=>[P(oe,{ref_key:"formRef",ref:U,class:"rule-row",model:_.value},{default:F(()=>[X("h6",null,pe(R.value.name)+" =",1),P(j,{label:" ",prop:"calcExpression","label-width":0,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u5F0F\u89C4\u5219"}]},{default:F(()=>[P(rn,{ref_key:"contendEditRef",ref:B,modelValue:_.value.expressionContent,"onUpdate:modelValue":f[0]||(f[0]=d=>_.value.expressionContent=d),operatorList:m.value,functionList:M.value,onChange:I},null,8,["modelValue","operatorList","functionList"])]),_:1}),P(C,null,{default:F(()=>[P(k,{loading:T.value,disabled:se.test(_.value.calcExpression),onClick:K},{default:F(()=>[ce(" \u6821\u9A8C\u516C\u5F0F ")]),_:1},8,["loading","disabled"]),X("span",{class:qe([V.value,"check-tip-span"])},pe(O.value),3)]),_:1})]),_:1},8,["model"]),P(re),P(C,{class:"rule-row"},{default:F(()=>[on,(ee(!0),le(ye,null,_e(r.value,(d,he)=>(ee(),le(ye,null,[!Y.value||Y.value.includes(d.type)?(ee(),le("div",{key:he},[X("p",null,pe(d.type),1),X("div",null,[(ee(!0),le(ye,null,_e(d.variableList,(g,Ee)=>(ee(),me(k,{key:Ee,disabled:g.code===R.value.code,class:"tag-span",onClick:Te=>Z(g)},{default:F(()=>[ce(pe(g.name),1)]),_:2},1032,["disabled","onClick"]))),128))])])):qt("",!0)],64))),256))]),_:1})]),_:1}),P(ae,{span:8},{default:F(()=>[P(C,{class:"rule-row"},{default:F(()=>[an,X("div",un,[(ee(!0),le(ye,null,_e(m.value,(d,he)=>(ee(),me(k,{key:he,class:"tag-span",onClick:g=>z(d)},{default:F(()=>{var g;return[ce(pe((g=d.value)!=null?g:d),1)]}),_:2},1032,["onClick"]))),128))])]),_:1}),P(C,{class:"rule-row"},{default:F(()=>[ln,(ee(!0),le(ye,null,_e(M.value,(d,he)=>(ee(),me(k,{key:he,class:"tag-span",onClick:g=>q(d)},{default:F(()=>[ce(pe(d==null?void 0:d.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}};var pn=Me(cn,[["__scopeId","data-v-85990e88"]]),Ce={exports:{}};(function(u,L){(function(S,y){y(L)})(Bt,function(S){var y="INUMBER",$="IOP1",D="IOP2",w="IOP3",_="IVAR",U="IVARNAME",Y="IFUNCALL",A="IFUNDEF",T="IEXPR",G="IEXPREVAL",R="IMEMBER",B="IENDSTATEMENT",se="IARRAY";function r(e,t){this.type=e,this.value=t!=null?t:0}function m(e){return new r($,e)}function M(e){return new r(D,e)}function J(e){return new r(w,e)}function O(e,t,n){var s,o,l,c,x,a,p=[];if(Z(e))return z(e,n);for(var E=e.length,h=0;h<E;h++){var v=e[h],W=v.type;if(W===y||W===U)p.push(v.value);else if(W===D)o=p.pop(),s=p.pop(),v.value==="and"?p.push(!!s&&!!O(o,t,n)):v.value==="or"?p.push(!!s||!!O(o,t,n)):v.value==="="?(c=t.binaryOps[v.value],p.push(c(s,O(o,t,n),n))):(c=t.binaryOps[v.value],p.push(c(z(s,n),z(o,n))));else if(W===w)l=p.pop(),o=p.pop(),s=p.pop(),v.value==="?"?p.push(O(s?o:l,t,n)):(c=t.ternaryOps[v.value],p.push(c(z(s,n),z(o,n),z(l,n))));else if(W===_)if(v.value in t.functions)p.push(t.functions[v.value]);else if(v.value in t.unaryOps&&t.parser.isOperatorEnabled(v.value))p.push(t.unaryOps[v.value]);else{var N=n[v.value];if(N===void 0)throw new Error("undefined variable: "+v.value);p.push(N)}else if(W===$)s=p.pop(),c=t.unaryOps[v.value],p.push(c(z(s,n)));else if(W===Y){for(a=v.value,x=[];0<a--;)x.unshift(z(p.pop(),n));if(!(c=p.pop()).apply||!c.call)throw new Error(c+" is not a function");p.push(c.apply(void 0,x))}else if(W===A)p.push(function(){for(var ie=p.pop(),ve=[],Ot=v.value;0<Ot--;)ve.unshift(p.pop());function Fe(){for(var Ve=Object.assign({},n),we=0,It=ve.length;we<It;we++)Ve[ve[we]]=arguments[we];return O(ie,t,Ve)}var Pe=p.pop();return Object.defineProperty(Fe,"name",{value:Pe,writable:!1}),n[Pe]=Fe}());else if(W===T)p.push(V(v,t));else if(W===G)p.push(v);else if(W===R)s=p.pop(),p.push(s[v.value]);else if(W===B)p.pop();else{if(W!==se)throw new Error("invalid Expression");for(a=v.value,x=[];0<a--;)x.unshift(p.pop());p.push(x)}}if(1<p.length)throw new Error("invalid Expression (parity)");return p[0]===0?0:z(p[0],n)}function V(e,t){return Z(e)?e:{type:G,value:function(n){return O(e.value,t,n)}}}function Z(e){return e&&e.type===G}function z(e,t){return Z(e)?e.value(t):e}function q(e,t){for(var n,s,o,l,c,x,a=[],p=0;p<e.length;p++){var E=e[p],h=E.type;if(h===y)typeof E.value=="number"&&E.value<0?a.push("("+E.value+")"):Array.isArray(E.value)?a.push("["+E.value.map(I).join(", ")+"]"):a.push(I(E.value));else if(h===D)s=a.pop(),n=a.pop(),l=E.value,t?l==="^"?a.push("Math.pow("+n+", "+s+")"):l==="and"?a.push("(!!"+n+" && !!"+s+")"):l==="or"?a.push("(!!"+n+" || !!"+s+")"):l==="||"?a.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+n+"),("+s+")))"):l==="=="?a.push("("+n+" === "+s+")"):l==="!="?a.push("("+n+" !== "+s+")"):l==="["?a.push(n+"[("+s+") | 0]"):a.push("("+n+" "+l+" "+s+")"):l==="["?a.push(n+"["+s+"]"):a.push("("+n+" "+l+" "+s+")");else if(h===w){if(o=a.pop(),s=a.pop(),n=a.pop(),(l=E.value)!=="?")throw new Error("invalid Expression");a.push("("+n+" ? "+s+" : "+o+")")}else if(h===_||h===U)a.push(E.value);else if(h===$)n=a.pop(),(l=E.value)==="-"||l==="+"?a.push("("+l+n+")"):t?l==="not"?a.push("(!"+n+")"):l==="!"?a.push("fac("+n+")"):a.push(l+"("+n+")"):l==="!"?a.push("("+n+"!)"):a.push("("+l+" "+n+")");else if(h===Y){for(x=E.value,c=[];0<x--;)c.unshift(a.pop());l=a.pop(),a.push(l+"("+c.join(", ")+")")}else if(h===A){for(s=a.pop(),x=E.value,c=[];0<x--;)c.unshift(a.pop());n=a.pop(),t?a.push("("+n+" = function("+c.join(", ")+") { return "+s+" })"):a.push("("+n+"("+c.join(", ")+") = "+s+")")}else if(h===R)n=a.pop(),a.push(n+"."+E.value);else if(h===se){for(x=E.value,c=[];0<x--;)c.unshift(a.pop());a.push("["+c.join(", ")+"]")}else if(h===T)a.push("("+q(E.value,t)+")");else if(h!==B)throw new Error("invalid Expression")}return 1<a.length&&(a=t?[a.join(",")]:[a.join(";")]),String(a[0])}function I(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function K(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}function Q(e,t,n){for(var s=!!(n=n||{}).withMembers,o=null,l=0;l<e.length;l++){var c=e[l];c.type===_||c.type===U?s||K(t,c.value)?o=(o!==null&&(K(t,o)||t.push(o)),c.value):t.push(c.value):c.type===R&&s&&o!==null?o+="."+c.value:c.type===T?Q(c.value,t,n):o!==null&&(K(t,o)||t.push(o),o=null)}o===null||K(t,o)||t.push(o)}function b(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}r.prototype.toString=function(){switch(this.type){case y:case $:case D:case w:case _:case U:case B:return this.value;case Y:return"CALL "+this.value;case A:return"DEF "+this.value;case se:return"ARRAY "+this.value;case R:return"."+this.value;default:return"Invalid Instruction"}},b.prototype.simplify=function(e){return e=e||{},new b(function t(n,s,o,l,c){for(var x,a,p,E,h=[],v=[],W=0;W<n.length;W++){var N=n[W],ie=N.type;if(ie===y||ie===U)Array.isArray(N.value)?h.push.apply(h,t(N.value.map(function(ve){return new r(y,ve)}).concat(new r(se,N.value.length)),s,o,l,c)):h.push(N);else if(ie===_&&c.hasOwnProperty(N.value))N=new r(y,c[N.value]),h.push(N);else if(ie===D&&1<h.length)a=h.pop(),x=h.pop(),E=o[N.value],N=new r(y,E(x.value,a.value)),h.push(N);else if(ie===w&&2<h.length)p=h.pop(),a=h.pop(),x=h.pop(),N.value==="?"?h.push(x.value?a.value:p.value):(E=l[N.value],N=new r(y,E(x.value,a.value,p.value)),h.push(N));else if(ie===$&&0<h.length)x=h.pop(),E=s[N.value],N=new r(y,E(x.value)),h.push(N);else if(ie===T){for(;0<h.length;)v.push(h.shift());v.push(new r(T,t(N.value,s,o,l,c)))}else if(ie===R&&0<h.length)x=h.pop(),h.push(new r(y,x.value[N.value]));else{for(;0<h.length;)v.push(h.shift());v.push(N)}}for(;0<h.length;)v.push(h.shift());return v}(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},b.prototype.substitute=function(e,t){return t instanceof b||(t=this.parser.parse(String(t))),new b(function n(s,o,l){for(var c=[],x=0;x<s.length;x++){var a=s[x],p=a.type;if(p===_&&a.value===o)for(var E=0;E<l.tokens.length;E++){var h,v=l.tokens[E];h=v.type===$?m(v.value):v.type===D?M(v.value):v.type===w?J(v.value):new r(v.type,v.value),c.push(h)}else p===T?c.push(new r(T,n(a.value,o,l))):c.push(a)}return c}(this.tokens,e,t),this.parser)},b.prototype.evaluate=function(e){return e=e||{},O(this.tokens,this,e)},b.prototype.toString=function(){return q(this.tokens,!1)},b.prototype.symbols=function(e){e=e||{};var t=[];return Q(this.tokens,t,e),t},b.prototype.variables=function(e){e=e||{};var t=[];Q(this.tokens,t,e);var n=this.functions;return t.filter(function(s){return!(s in n)})},b.prototype.toJSFunction=function(e,t){var n=this,s=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+q(this.simplify(t).tokens,!0)+"; }");return function(){return s.apply(n,arguments)}};var te="TEOF",i="TOP",f="TNUMBER",j="TSTRING",k="TPAREN",C="TBRACKET",oe="TCOMMA",re="TNAME",ae="TSEMICOLON";function xe(e,t,n){this.type=e,this.value=t,this.index=n}function d(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}xe.prototype.toString=function(){return this.type+": "+this.value},d.prototype.newToken=function(e,t,n){return new xe(e,t,n!=null?n:this.pos)},d.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},d.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},d.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(te,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},d.prototype.isString=function(){var e=!1,t=this.pos,n=this.expression.charAt(t);if(n==="'"||n==='"')for(var s=this.expression.indexOf(n,t+1);0<=s&&this.pos<this.expression.length;){if(this.pos=s+1,this.expression.charAt(s-1)!=="\\"){var o=this.expression.substring(t+1,s);this.current=this.newToken(j,this.unescape(o),t),e=!0;break}s=this.expression.indexOf(n,s+1)}return e},d.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return(e==="("||e===")")&&(this.current=this.newToken(k,e),this.pos++,!0)},d.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return!(e!=="["&&e!=="]"||!this.isOperatorEnabled("["))&&(this.current=this.newToken(C,e),this.pos++,!0)},d.prototype.isComma=function(){return this.expression.charAt(this.pos)===","&&(this.current=this.newToken(oe,","),this.pos++,!0)},d.prototype.isSemicolon=function(){return this.expression.charAt(this.pos)===";"&&(this.current=this.newToken(ae,";"),this.pos++,!0)},d.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||n!=="_"&&n!=="."&&(n<"0"||"9"<n)))break}if(e<t){var s=this.expression.substring(e,t);if(s in this.consts)return this.current=this.newToken(f,this.consts[s]),this.pos+=s.length,!0}return!1},d.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||n!=="_"&&(n<"0"||"9"<n)))break}if(e<t){var s=this.expression.substring(e,t);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(i,s),this.pos+=s.length,!0}return!1},d.prototype.isName=function(){for(var e=this.pos,t=e,n=!1;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()){if(t===this.pos&&(s==="$"||s==="_")){s==="_"&&(n=!0);continue}if(t===this.pos||!n||s!=="_"&&(s<"0"||"9"<s))break}else n=!0}if(n){var o=this.expression.substring(e,t);return this.current=this.newToken(re,o),this.pos+=o.length,!0}return!1},d.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);!(t!==" "&&t!=="	"&&t!==`
`&&t!=="\r"||(e=!0,this.pos++,this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var he=/^[0-9a-f]{4}$/i;function g(e,t,n){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=n.allowMemberAccess!==!1}d.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var n=e.substring(0,t);0<=t;){var s=e.charAt(++t);switch(s){case"'":n+="'";break;case'"':n+='"';break;case"\\":n+="\\";break;case"/":n+="/";break;case"b":n+="\b";break;case"f":n+="\f";break;case"n":n+=`
`;break;case"r":n+="\r";break;case"t":n+="	";break;case"u":var o=e.substring(t+1,t+5);he.test(o)||this.parseError("Illegal escape sequence: \\u"+o),n+=String.fromCharCode(parseInt(o,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++t;var l=e.indexOf("\\",t);n+=e.substring(t,l<0?e.length:l),t=l}return n},d.prototype.isComment=function(){return this.expression.charAt(this.pos)==="/"&&this.expression.charAt(this.pos+1)==="*"&&(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0)},d.prototype.isRadixInteger=function(){var e,t,n=this.pos;if(n>=this.expression.length-2||this.expression.charAt(n)!=="0")return!1;if(++n,this.expression.charAt(n)==="x")e=16,t=/^[0-9a-f]$/i,++n;else{if(this.expression.charAt(n)!=="b")return!1;e=2,t=/^[01]$/i,++n}for(var s=!1,o=n;n<this.expression.length;){var l=this.expression.charAt(n);if(!t.test(l))break;n++,s=!0}return s&&(this.current=this.newToken(f,parseInt(this.expression.substring(o,n),e)),this.pos=n),s},d.prototype.isNumber=function(){for(var e,t=!1,n=this.pos,s=n,o=n,l=!1,c=!1;n<this.expression.length&&("0"<=(e=this.expression.charAt(n))&&e<="9"||!l&&e===".");)e==="."?l=!0:c=!0,n++,t=c;if(t&&(o=n),e==="e"||e==="E"){n++;for(var x=!0,a=!1;n<this.expression.length;){if(e=this.expression.charAt(n),!x||e!=="+"&&e!=="-"){if(!("0"<=e&&e<="9"))break;x=!(a=!0)}else x=!1;n++}a||(n=o)}return t?(this.current=this.newToken(f,parseFloat(this.expression.substring(s,n))),this.pos=n):this.pos=o,t},d.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(i,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(i,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(i,">="),this.pos++):this.current=this.newToken(i,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(i,"<="),this.pos++):this.current=this.newToken(i,"<");else if(t==="|"){if(this.expression.charAt(this.pos+1)!=="|")return!1;this.current=this.newToken(i,"||"),this.pos++}else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(i,"=="),this.pos++):this.current=this.newToken(i,t);else{if(t!=="!")return!1;this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(i,"!="),this.pos++):this.current=this.newToken(i,t)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=e,!1)},d.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},d.prototype.getCoordinates=function(){for(var e,t=0,n=-1;t++,e=this.pos-n,0<=(n=this.expression.indexOf(`
`,n+1))&&n<this.pos;);return{line:t,column:e}},d.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)},g.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},g.prototype.tokenMatches=function(e,t){return t===void 0||(Array.isArray(t)?K(t,e.value):typeof t=="function"?t(e):e.value===t)},g.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},g.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},g.prototype.accept=function(e,t){return!(this.nextToken.type!==e||!this.tokenMatches(this.nextToken,t))&&(this.next(),!0)},g.prototype.expect=function(e,t){if(!this.accept(e,t)){var n=this.tokens.getCoordinates();throw new Error("parse error ["+n.line+":"+n.column+"]: Expected "+(t||e))}},g.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;if(this.accept(re)||this.accept(i,function(s){return s.value in t}))e.push(new r(_,this.current.value));else if(this.accept(f))e.push(new r(y,this.current.value));else if(this.accept(j))e.push(new r(y,this.current.value));else if(this.accept(k,"("))this.parseExpression(e),this.expect(k,")");else{if(!this.accept(C,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(C,"]"))e.push(new r(se,0));else{var n=this.parseArrayList(e);e.push(new r(se,n))}}},g.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),this.parseUntilEndStatement(e,t)||this.pushExpression(e,t))},g.prototype.pushExpression=function(e,t){for(var n=0,s=t.length;n<s;n++)e.push(t[n])},g.prototype.parseUntilEndStatement=function(e,t){return!!this.accept(ae)&&(!this.nextToken||this.nextToken.type===te||this.nextToken.type===k&&this.nextToken.value===")"||t.push(new r(B)),this.nextToken.type!==te&&this.parseExpression(t),e.push(new r(T,t)),!0)},g.prototype.parseArrayList=function(e){for(var t=0;!this.accept(C,"]");)for(this.parseExpression(e),++t;this.accept(oe);)this.parseExpression(e),++t;return t},g.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(i,"=");){var t=e.pop(),n=[],s=e.length-1;if(t.type!==Y){if(t.type!==_&&t.type!==R)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(n),e.push(new r(U,t.value)),e.push(new r(T,n)),e.push(M("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var o=0,l=t.value+1;o<l;o++){var c=s-o;e[c].type===_&&(e[c]=new r(U,e[c].value))}this.parseVariableAssignmentExpression(n),e.push(new r(T,n)),e.push(new r(A,t.value))}}},g.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(i,"?");){var t=[],n=[];this.parseConditionalExpression(t),this.expect(i,":"),this.parseConditionalExpression(n),e.push(new r(T,t)),e.push(new r(T,n)),e.push(J("?"))}},g.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(i,"or");){var t=[];this.parseAndExpression(t),e.push(new r(T,t)),e.push(M("or"))}},g.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(i,"and");){var t=[];this.parseComparison(t),e.push(new r(T,t)),e.push(M("and"))}};var Ee=["==","!=","<","<=",">=",">","in"];g.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(i,Ee);){var t=this.current;this.parseAddSub(e),e.push(M(t.value))}};var Te=["+","-","||"];g.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(i,Te);){var t=this.current;this.parseTerm(e),e.push(M(t.value))}};var je=["*","/","%"];function Ue(e,t){return Number(e)+Number(t)}function Be(e,t){return e-t}function ze(e,t){return e*t}function De(e,t){return e/t}function He(e,t){return e%t}function We(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function Xe(e,t){return e===t}function Ge(e,t){return e!==t}function Ye(e,t){return t<e}function Je(e,t){return e<t}function Ke(e,t){return t<=e}function Qe(e,t){return e<=t}function Ze(e,t){return Boolean(e&&t)}function et(e,t){return Boolean(e||t)}function tt(e,t){return K(t,e)}function nt(e){return(Math.exp(e)-Math.exp(-e))/2}function st(e){return(Math.exp(e)+Math.exp(-e))/2}function rt(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function it(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function ot(e){return Math.log(e+Math.sqrt(e*e-1))}function at(e){return Math.log((1+e)/(1-e))/2}function Se(e){return Math.log(e)*Math.LOG10E}function ut(e){return-e}function lt(e){return!e}function ct(e){return e<0?Math.ceil(e):Math.floor(e)}function pt(e){return Math.random()*(e||1)}function Oe(e){return ke(e+1)}g.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(i,je);){var t=this.current;this.parseFactor(e),e.push(M(t.value))}},g.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;if(this.save(),this.accept(i,function(s){return s.value in t})){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===k&&this.nextToken.value==="(")return this.restore(),void this.parseExponential(e);if(this.nextToken.type===ae||this.nextToken.type===oe||this.nextToken.type===te||this.nextToken.type===k&&this.nextToken.value===")")return this.restore(),void this.parseAtom(e)}var n=this.current;this.parseFactor(e),e.push(m(n.value))}else this.parseExponential(e)},g.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(i,"^");)this.parseFactor(e),e.push(M("^"))},g.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(i,"!");)e.push(m("!"))},g.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;if(this.accept(i,function(o){return o.value in t})){var n=this.current;this.parseAtom(e),e.push(m(n.value))}else for(this.parseMemberExpression(e);this.accept(k,"(");)if(this.accept(k,")"))e.push(new r(Y,0));else{var s=this.parseArgumentList(e);e.push(new r(Y,s))}},g.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(k,")");)for(this.parseExpression(e),++t;this.accept(oe);)this.parseExpression(e),++t;return t},g.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(i,".")||this.accept(C,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(re),e.push(new r(R,this.current.value))}else{if(t.value!=="[")throw new Error("unexpected symbol: "+t.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(C,"]"),e.push(M("["))}}};var ht=4.7421875,be=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function ke(e){var t,n;if(function(E){return isFinite(E)&&E===Math.round(E)}(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(171<e)return 1/0;for(var s=e-2,o=e-1;1<s;)o*=s,s--;return o===0&&(o=1),o}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*ke(1-e));if(171.35<=e)return 1/0;if(85<e){var l=e*e,c=l*e,x=c*e,a=x*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*l)-139/(51840*c)-571/(2488320*x)+163879/(209018880*a)+5246819/(75246796800*a*e))}--e,n=be[0];for(var p=1;p<be.length;++p)n+=be[p]/(e+p);return t=e+ht+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*n}function ft(e){return Array.isArray(e)?e.length:String(e).length}function Ie(){for(var e=0,t=0,n=0;n<arguments.length;n++){var s,o=Math.abs(arguments[n]);t<o?(e=e*(s=t/o)*s+1,t=o):e+=0<o?(s=o/t)*s:o}return t===1/0?1/0:t*Math.sqrt(e)}function Ne(e,t,n){return e?t:n}function dt(e,t){return t===void 0||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||typeof t!="number"||t%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+t:t))))}function vt(e,t,n){return n&&(n[e]=t),t}function yt(e,t){return e[0|t]}function mt(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function gt(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function xt(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(n,s){return e(n,s)})}function wt(e,t,n){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(n))throw new Error("Second argument to fold is not an array");return n.reduce(function(s,o,l){return e(s,o,l)},t)}function _t(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(n,s){return e(n,s)})}function Et(e,t){if(!Array.isArray(t)&&typeof t!="string")throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function bt(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function kt(e){return(0<e)-(e<0)||+e}var Le=1/3;function Ct(e){return e<0?-Math.pow(-e,Le):Math.pow(e,Le)}function Mt(e){return Math.exp(e)-1}function At(e){return Math.log(1+e)}function Tt(e){return Math.log(e)/Math.LN2}function ue(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||nt,cosh:Math.cosh||st,tanh:Math.tanh||rt,asinh:Math.asinh||it,acosh:Math.acosh||ot,atanh:Math.atanh||at,sqrt:Math.sqrt,cbrt:Math.cbrt||Ct,log:Math.log,log2:Math.log2||Tt,ln:Math.log,lg:Math.log10||Se,log10:Math.log10||Se,expm1:Math.expm1||Mt,log1p:Math.log1p||At,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ct,"-":ut,"+":Number,exp:Math.exp,not:lt,length:ft,"!":Oe,sign:Math.sign||kt},this.binaryOps={"+":Ue,"-":Be,"*":ze,"/":De,"%":He,"^":Math.pow,"||":We,"==":Xe,"!=":Ge,">":Ye,"<":Je,">=":Ke,"<=":Qe,and:Ze,or:et,in:tt,"=":vt,"[":yt},this.ternaryOps={"?":Ne},this.functions={random:pt,fac:Oe,min:gt,max:mt,hypot:Math.hypot||Ie,pyt:Math.hypot||Ie,pow:Math.pow,atan2:Math.atan2,if:Ne,gamma:ke,roundTo:dt,map:xt,fold:wt,filter:_t,indexOf:Et,join:bt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}ue.prototype.parse=function(e){var t=[],n=new g(this,new d(this,e),{allowMemberAccess:this.options.allowMemberAccess});return n.parseExpression(t),n.expect(te,"EOF"),new b(t,this)},ue.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var Re=new ue;ue.parse=function(e){return Re.parse(e)},ue.evaluate=function(e,t){return Re.parse(e).evaluate(t)};var $e={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};ue.prototype.isOperatorEnabled=function(e){var t=function(s){return $e.hasOwnProperty(s)?$e[s]:s}(e),n=this.options.operators||{};return!(t in n&&!n[t])};var St={Parser:ue,Expression:b};S.Expression=b,S.Parser=ue,S.default=St,Object.defineProperty(S,"__esModule",{value:!0})})})(Ce,Ce.exports);const hn={class:"index-page"},fn=X("h3",null,"\u6B22\u8FCE\u4F7F\u7528\u4E1A\u52A1\u89C4\u5219\u516C\u5F0F\u7F16\u8F91\u5668",-1),dn=X("p",{style:{margin:"16px 0"}},"\u516C\u5F0F\u89C4\u5219:",-1),vn={class:"content"},yn=X("p",{style:{margin:"16px 0"}},"\u5B9E\u9645\u516C\u5F0F\u89C4\u5219:",-1),mn={class:"content"},xn={__name:"index",setup(u){const L=H([{type:"\u8425\u4E1A\u4F53\u7CFB",variableList:[{code:"MAIN_BUSINESS_INCOME",name:"\u4E3B\u8425\u4E1A\u52A1\u6536\u5165"},{code:"MATERIAL_SALES_INCOME",name:"\u6750\u6599\u9500\u552E\u6536\u5165"},{code:"OTHER_BUSINESS_INCOME",name:"\u5176\u4ED6\u4E1A\u52A1\u6536\u5165"},{code:"MAIN_BUSINESS_COST",name:"\u4E3B\u8425\u4E1A\u52A1\u6210\u672C"},{code:"BUSINESS_TAX_SURCHARGE",name:"\u8425\u4E1A\u7A0E\u91D1\u53CA\u9644\u52A0"},{code:"OPERATING_EXPENSES",name:"\u8425\u4E1A\u8D39\u7528"}]},{type:"\u8D44\u4EA7\u8FD0\u8425",variableList:[{code:"SELLING_EXPENSES",name:"\u9500\u552E\u8D39\u7528"},{code:"FINANCIAL_EXPENSES",name:"\u8D22\u52A1\u8D39\u7528"},{code:"INVESTMENT_INCOME",name:"\u6295\u8D44\u6536\u76CA"},{code:"ASSET_IMPAIRMENT_LOSS",name:"\u8D44\u4EA7\u51CF\u503C\u635F\u5931"}]},{type:"\u5176\u4ED6",variableList:[{code:"OTHER_BUSINESS_COST",name:"\u5176\u4ED6\u4E1A\u52A1\u6210\u672C"}]},{type:"\u7CFB\u6570",variableList:[{code:"PERFORMANCE_COEFFICIENT",name:"\u7EE9\u6548\u7CFB\u6570"},{code:"ANNUAL",name:"\u5E74\u5EA6"},{code:"QUARTERLY",name:"\u5B63\u5EA6"},{code:"MONTHLY",name:"\u6708\u5EA6"}]}]),S=H({expressionContent:"#\u4E3B\u8425\u4E1A\u52A1\u6536\u5165#+#\u6750\u6599\u9500\u552E\u6536\u5165#",calcExpression:"MAIN_BUSINESS_INCOME+MATERIAL_SALES_INCOME"}),y=H(null),$=H([{label:"AND",value:"AND",offsetIdx:0},{label:"OR",value:"OR",offsetIdx:0},{label:"IF",value:["IF(",")"]},{label:"HALT",value:['HALT("','", , )']}]),D=new Ce.exports.Parser,w=A=>new Promise((T,G)=>{A.calcList.forEach(B=>{B.type==="field"&&(D.consts[B.value]=1)});const R=D.evaluate(A.calcExpression);return(R!==null||R===void 0)&&T({success:!0,message:"\u516C\u5F0F\u6821\u9A8C\u901A\u8FC7"}),R}),_=()=>new Promise(A=>{A(L.value)}),U=()=>{const A={name:"\u8425\u4E1A\u5229\u6DA6",code:""};y.value.open({...A,...S.value})},Y=A=>{A&&(S.value.expressionContent=A.expressionContent,S.value.calcExpression=A.calcExpression)};return(A,T)=>{const G=ne("el-icon"),R=ne("el-button"),B=ne("el-row");return ee(),le("div",hn,[fn,X("div",null,[dn,X("div",vn,[ce(pe(S.value.expressionContent)+" ",1),P(R,{type:"",link:"",title:"\u7F16\u8F91",onClick:U},{default:F(()=>[P(G,null,{default:F(()=>[P(zt(Dt))]),_:1})]),_:1})]),yn,X("div",mn,pe(S.value.calcExpression),1),P(R,{type:"primary",onClick:U},{default:F(()=>[ce("\u7F16\u8F91\u89C4\u5219")]),_:1})]),P(B),P(pn,{ref_key:"formulaRulesRef",ref:y,title:"\u7F16\u8F91\u516C\u5F0F\u89C4\u5219",request:{queryVariable:_,checkRule:w,functionList:$.value},onChange:Y},null,8,["request"])])}}};export{xn as default};
