import{k as w,j as m,M as q,L as ue,l as F,T as ie,m as Z,w as b,b as I,o as V,a as D,y as N,i as M,O as re,f as v,c as P,p as G,F as J,e as K,_ as ce,U as ve,V as S,W as de,n as Q,t as A}from"./index.706da384.js";import{u as me}from"./uniqueId.2069039e.js";const pe={class:"menu-main-box"},fe=["onClick"],xe=["onClick"],Te={class:"botBut"},X="YYYY-MM-DD",ye="HH:mm",B=80,f=32,he={__name:"hm-picker",props:{modelValue:{type:String,default:""},isNextDay:{type:Number,defualt:0},nextText:{type:String,default:"\u6B21\u65E5"},maxNextHour:{type:Number},id:{type:String,default:me("time-picker-")},placeholder:{type:String,default:"\u8BF7\u9009\u62E9\u65F6\u95F4"},disabled:{type:Boolean,default:!1},isDate:{type:Boolean,default:!1},style:{type:Object},disabledMinutes:{type:Function}},emits:["update:modelValue","update:isNextDay","change","blur"],setup(E,{emit:C}){const H=(t,e)=>{var o;const l=[],c=e==null?void 0:e();for(let i=0;i<t;i+=1)l.push({value:`${i>9?i:`0${i}`}`,disabled:(o=c==null?void 0:c.includes(i))!=null?o:!1});return l},p=C,s=E,L=H(24),k=w(()=>{const t=a.value,e=s.disabledMinutes;return H(60,e&&(()=>e==null?void 0:e(t)))}),x=m(""),h=m(s.isNextDay),u=m(!1),a=m(0),r=m(0),T=m(!1),g=m(),U=m(),_=m(),y=m(),ee=w(()=>{const t=[];if(s.maxNextHour!==void 0&&s.maxNextHour!==-1)for(let e=0;e<=s.maxNextHour;e+=1)t.push({value:`${s.nextText}${e>9?e:`0${e}`}`});return t}),Y=w(()=>[...L,...ee.value]),te=()=>{T.value||(u.value=!0,p("focus"))},le=()=>{p("visible-change",!0)},ne=()=>{u.value=!1,p("visible-change",!1)},j=(t,e,l)=>{e.disabled||(t==="h"?_.value.scrollTop=Math.max(l*1,0)*f:y.value.scrollTop=l*f)},$=t=>{const e=_.value.scrollTop,l=Math.round(e/f);_.value.scrollTop=l*f;const c=y.value.scrollTop,o=Math.round(c/f);y.value.scrollTop=o*f},se=()=>{ve(g.value,t=>{const e=N(U.value),l=N(g.value);e&&(t.target===e||t.composedPath().includes(e))||t.target===l||t.composedPath().includes(l)||u.value&&(O(),u.value=!1)})},z=t=>{if(!T.value){if(T.value=!0,setTimeout(()=>{T.value=!1},100),t==="yes"){const{nextType:e,time:l}=ae(x.value);h.value=Number(Boolean(e)),p("update:modelValue",l),p("update:isNextDay",N(h.value)),p("change",l,N(h.value)),p("blur",l)}else O();F(()=>{u.value=!1,g.value&&g.value.blur()})}},ae=t=>{const e=N(t),l=/[\u4e00-\u9fa5]+/g,c=/[0-9:]+/g,o={nextType:"",time:""};let i;for(;(i=l.exec(e))!==null;)o.nextType+=i[0];for(;(i=c.exec(e))!==null;)o.time+=i[0];if(s.isDate){const n=S(),d=n.format(X),R=n.add(1,"day").format(X),oe=o.nextType?R:d;o.time=`${oe} ${o.time}`}return o},O=()=>{const t=s.modelValue;let e=s.isNextDay;if(!t){x.value="",h.value=0;return}let[l="00",c="00"]=t.split(":");if(s.isDate){const n=S(),d=S(t);e=Number(!d.isSame(n,"day")),h.value=e,p("update:isNextDay",h.value),x.value=`${e?s.nextText:""}${d.format(ye)}`,[l="00",c="00"]=t.split(" ")[1].split(":")}else x.value=`${e?s.nextText:""}${t}`;e&&(l=`${s.nextText}${l}`);const o=Y.value.findIndex(n=>n.value===l),i=k.value.findIndex(n=>n.value===c);if(o===-1){console.log(new Error("don't find the value of afterHour, please set maxNextHour"));return}a.value=o,r.value=i},W=()=>{if(h.value=Number(a.value>L.length-1),k.value[r.value].disabled){const e=[...k.value].reverse().find(c=>!c.disabled);let l=0;e&&(l=e.value),l!==r.value&&(r.value=l,y.value.scrollTop=r.value*f+1)}x.value=`${Y.value[a.value].value}:${k.value[r.value].value}`};return q(()=>s.modelValue,t=>{O()},{deep:!0,immediate:!0}),q(()=>u.value,t=>{!s.disabled&&t?F(()=>{_.value.scrollTop=Math.max(a.value*1,0)*f+1,y.value.scrollTop=r.value*f+1,setTimeout(()=>{_.value.scrollTop=_.value.scrollTop-1,y.value.scrollTop=y.value.scrollTop-1},10)}):(document.removeEventListener("scroll",()=>{}),document.removeEventListener("click",()=>{}))}),ue(()=>{F(()=>{se(),_.value.addEventListener("scroll",t=>{t.preventDefault();const e=_.value.scrollTop;!s.modelValue&&!x.value&&e<2||(a.value=Math.round(e/f),W())}),y.value.addEventListener("scroll",t=>{t.preventDefault();const e=y.value.scrollTop;!s.modelValue&&!x.value&&e<2||(r.value=Math.round(e/f),W())})})}),ie(()=>{document.removeEventListener("scroll",()=>{}),document.removeEventListener("click",()=>{})}),(t,e)=>{const l=I("el-icon"),c=I("el-input"),o=I("el-button"),i=I("el-tooltip");return V(),Z(i,{ref:"refPopper",visible:u.value,effect:"light",pure:"",trigger:"click",role:"dialog",teleported:"","popper-class":"time-picker-box","fallback-placements":["bottom","top","right","left"],"gpu-acceleration":!1,"stop-popper-mouse-event":!1,"virtual-triggering":!1,"hide-after":0,persistent:"",onShow:le,onHide:ne},{default:b(()=>[D(c,{ref_key:"timeInput",ref:g,style:M({...E.style}),onFocus:te,disabled:E.disabled,"model-value":x.value,placeholder:E.placeholder,onClick:e[0]||(e[0]=re(()=>{},["stop"]))},{prefix:b(()=>[D(l,null,{default:b(()=>[D(N(de))]),_:1})]),_:1},8,["style","disabled","model-value","placeholder"])]),content:b(()=>[v("div",{class:"menu-box",ref_key:"menuBoxRef",ref:U},[v("div",{class:"menu-main",onMouseenter:e[7]||(e[7]=n=>$("Enter")),onMouseleave:e[8]||(e[8]=n=>$("Leave"))},[v("div",pe,[v("ul",{class:"leftTime container",ref_key:"leftTime",ref:_,onMouseenter:e[1]||(e[1]=n=>$("Enter")),onMouseleave:e[2]||(e[2]=n=>$("Leave"))},[v("li",{class:"timeItem",style:M({height:B+"px"})},null,4),(V(!0),P(J,null,G(Y.value,(n,d)=>(V(),P("li",{onClick:R=>j("h",n,d),ref_for:!0,ref:"timeItem"+d,key:d+"01",class:Q({activeTime:d===a.value})},A(n.value),11,fe))),128)),v("li",{class:"timeItem",style:M({height:B+"px"})},null,4)],544),v("ul",{class:"rightTime container",ref_key:"rightTime",ref:y,onMouseenter:e[3]||(e[3]=n=>$("Enter")),onMouseleave:e[4]||(e[4]=n=>$("Leave"))},[v("li",{class:"timeItem",style:M({height:B+"px"})},null,4),(V(!0),P(J,null,G(k.value,(n,d)=>(V(),P("li",{onClick:R=>j("m",n,d),key:d+"02",class:Q({activeTime:d===r.value,disbaled:n.disabled})},A(n.value),11,xe))),128)),v("li",{class:"timeItem",style:M({height:B+"px"})},null,4)],544)]),v("div",Te,[D(o,{class:"elbutton",link:"",type:"info",onClick:e[5]||(e[5]=n=>z("close"))},{default:b(()=>[K(" \u53D6\u6D88 ")]),_:1}),D(o,{class:"elbutton",link:"",type:"primary",onClick:e[6]||(e[6]=n=>z("yes"))},{default:b(()=>[K(" \u786E\u5B9A ")]),_:1})]),v("div",{class:"line",style:M({top:`calc(50% - ${f-2}px)`})},null,4),v("div",{class:"line",style:M({top:`calc(50% + ${2}px)`})},null,4)],32)],512)]),_:1},8,["visible"])}}};var ge=ce(he,[["__scopeId","data-v-41d8d533"]]);const ke={__name:"index",setup(E){const C=m(["hmPicker"]),H=S().format("YYYY-MM-DD"),p=m(`${H} 03:30`),s=m(`${H} 23:30`),L=w(()=>{const u=new Date(p.value).getMinutes(),a=new Date(p.value).getHours();return u>0||a>=0?a:-1}),k=w(()=>new Date(p.value).getMinutes()),x=(u,a)=>{const r=[];for(let T=u;T<=a;T+=1)r.push(T);return r},h=u=>{if(u===L.value+24)return x(k.value,59)};return(u,a)=>{const r=I("el-collapse-item"),T=I("el-collapse");return V(),Z(T,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=g=>C.value=g),accordion:""},{default:b(()=>[D(r,{title:"hmPicker",name:"hmPicker"},{default:b(()=>[v("div",null,[D(ge,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=g=>s.value=g),format:"HH:mm","max-next-hour":L.value,disabledMinutes:h,isDate:!0},null,8,["modelValue","max-next-hour"])]),v("div",null,A(u.treeValue),1)]),_:1})]),_:1},8,["modelValue"])}}};export{ke as default};
