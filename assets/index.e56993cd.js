import{_ as Me,o as te,c as le,f as J,g as Nt,v as Lt,h as Rt,n as qe,i as $t,d as Ft,j as X,k as de,l as ge,b as se,m as me,w as j,a as U,e as ce,t as pe,p as _e,F as ye,E as Pt,q as Vt,s as qt,u as jt,x as Ut,y as Bt,z as zt}from"./index.706da384.js";import{u as Dt}from"./uniqueId.2069039e.js";const Ht=["advlist indent2em anchor autolink code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"],Wt=["searchreplace forecolor backcolor bold italic underline strikethrough alignleft aligncenter alignright outdent indent undo redo subscript superscript","fontsizeselect indent2em hr bullist numlist link image charmap anchor pagebreak code codesample blockquote removeformat fullscreen"];let fe=[];function Xt(){return window.tinymce}const Gt=(l,R)=>{const O=document.getElementById(l),y=R||function(){};if(!O){const b=document.createElement("script");b.src=l,b.id=l,document.body.appendChild(b),fe.push(y),("onload"in b?P:W)(b)}O&&y&&(Xt()?y(null,O):fe.push(y));function P(b){b.onload=function(){this.onerror=null,this.onload=null;for(const k of fe)k(null,b);fe=null},b.onerror=function(){this.onerror=null,this.onload=null,y(new Error(`Failed to load ${l}`),b)}}function W(b){b.onreadystatechange=function(){if(!(this.readyState!=="complete"&&this.readyState!=="loaded")){this.onreadystatechange=null;for(const k of fe)k(null,b);fe=null}}}},Yt={name:"Tinymce",props:{id:{type:String,default(){return`vue-tinymce-${+new Date}${(Math.random()*1e3).toFixed(0)}`}},tinymceCDN:{type:String,default:"https://public-web-res-1312176471.cos.ap-guangzhou.myqcloud.com/tinymce-5.10.0/tinymce.min.js"},disabled:{type:Boolean,default:!1},modelValue:{type:String,default:""},toolbar:{type:Array,required:!1,default(){return[]}},fontsizes:{type:String,default:"11px 12px 14px 16px 18px 20px 24px 36px 48px"},menubar:{type:String,default:"file edit insert view format table my1"},height:{type:[Number,String],required:!1,default:360},width:{type:[Number,String],required:!1,default:"auto"},config:{type:Object}},data(){return{hasChange:!1,hasInit:!1,tinymceId:this.id,fullscreen:!1,languageTypeList:{en:"en",zh:"zh_CN",es:"es_MX",ja:"ja"}}},computed:{containerWidth(){const l=this.width;return/^[\d]+(\.[\d]+)?$/.test(l)?`${l}px`:l}},watch:{modelValue(l){!this.hasChange&&this.hasInit&&this.$nextTick(()=>window.tinymce.get(this.tinymceId).setContent(l||""))},disabled(l){window.tinymce&&window.tinymce.get(this.tinymceId)&&window.tinymce.get(this.tinymceId).mode.set(l?"readonly":"design")}},mounted(){this.init()},activated(){window.tinymce&&this.initTinymce()},deactivated(){this.destroyTinymce()},unmounted(){this.destroyTinymce()},methods:{init(){Gt(this.tinymceCDN,l=>{if(this.$emit("loadTinymce",l),l){this.$message.error(l.message);return}this.initTinymce()})},initTinymce(){const l=this;window.tinymce.init({selector:`#${this.tinymceId}`,language:this.languageTypeList.zh,height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar.length>0?this.toolbar:Wt,menubar:this.menubar,fontsize_formats:this.fontsizes,plugins:Ht,readonly:this.disabled,end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,init_instance_callback:R=>{this.$emit("initInstanceCallback",R),l.modelValue&&R.setContent(l.modelValue),l.hasInit=!0,R.on("NodeChange Change KeyUp SetContent",()=>{this.hasChange=!0,this.$emit("update:modelValue",R.getContent())})},setup(R){R.on("FullscreenStateChanged",O=>{l.fullscreen=O.state})},convert_urls:!1,...this.config})},destroyTinymce(){const l=window.tinymce.get(this.tinymceId);this.fullscreen&&l.execCommand("mceFullScreen"),l&&l.destroy()},setContent(l){window.tinymce.get(this.tinymceId).setContent(l)},getContent(){window.tinymce.get(this.tinymceId).getContent()}}},Jt=["id"],Kt={class:"editor-custom-menu-right"};function Qt(l,R,O,y,P,W){return te(),le("div",{class:qe(["tinymce-container",{fullscreen:P.fullscreen,"tinymce-container-disabled":O.disabled}]),style:$t({width:W.containerWidth})},[J("textarea",{id:P.tinymceId,class:"tinymce-textarea"},null,8,Jt),Nt(J("div",Kt,[Rt(l.$slots,"menu-right",{},void 0,!0)],512),[[Lt,!O.disabled]])],6)}var Zt=Me(Yt,[["render",Qt],["__scopeId","data-v-39476db6"]]);const en=Ft({components:{tinymce:Zt},props:{modelValue:{type:String,defualt:""},id:{type:String,default:"tinymce-formula"},operatorList:{type:Array,default:()=>[]},functionList:{type:Array,default:()=>[]},color:{type:String,default:"#1C88E5"}},setup(l,{emit:R}){const O=X(null),y=de(()=>Dt(l.id)),P=X(""),W=X({toolbar:[],plugins:["autoresize"],menubar:[],statusbar:!1,autoresize_bottom_margin:20,autoresize_min_height:100,autoresize_max_height:500,content_style:`p {font-size: 14px} .mention-field{color: ${l.color}}`});let b=!1;const k=(h,f=0)=>{const L=document.createRange();return L.setStart(h,f),L.setEnd(h,f),L},B=()=>{const h=window.tinyMCE.editors[y.value];h.setContent(P.value,{noSelection:!0}),ge(()=>{requestAnimationFrame(()=>{const f=h.selection.getEnd();h.selection.setRng(k(f,f.childNodes.length)),h.focus()})}),b=!0},K=h=>{var M;const f=(M=window.tinyMCE)==null?void 0:M.editors[y.value];if(!f)return;const L=f.getBody(),V=L.textContent;if(l.modelValue===V)return;const G=L.childNodes,q=[],D=l.operatorList.map(ee=>{var $;return`\\${($=ee.value)!=null?$:ee}`}).join(""),Z=new RegExp(`([${D}])`),H=new RegExp(`([${D}])`);G.forEach(ee=>{for(let $=0;$<ee.childNodes.length;$+=1){const F=ee.childNodes[$],r=F.nodeType===1&&(F==null?void 0:F.getAttribute)?F==null?void 0:F.getAttribute("class"):"",x=F!=null&&F.getAttribute?F==null?void 0:F.getAttribute("data-mce-selected"):"",S=F.textContent;x||(F.nodeType===3?S!==""&&q.push({type:"text",value:g(S)}):r&&r.indexOf("mention-field")!==-1?S!==""&&q.push({type:"field",value:S}):r&&r.indexOf("mention-operator")!==-1?S.split(Z).forEach(w=>{w!==""&&q.push({type:H.test(w)?"operator":"text",value:g(w)})}):q.push({type:"text",value:g(S)}))}}),R("changeHtmlContent",h),R("change",q),R("input:modelValue",V)},g=h=>h.replace(/\s+/g," "),A=()=>{window.tinyMCE.editors[y.value].on("change input undo redo",f=>{K(f)}),b||B()},Q=({value:h,type:f,offset:L,offsetIdx:V})=>{const G=window.tinyMCE.editors[y.value];if(f==="operator")L?(G.insertContent(h),I(V)):G.insertContent(h);else if(f==="field")G.insertContent(`<span class="mention-${f}" contenteditable="false">${`#${h}#`}</span>`);else{if(Object.prototype.toString.call(h)==="[object Array]")for(let q=0;q<h.length;q++)G.insertContent(h[q]);else G.insertContent(h);L&&I(V)}A(),G.focus()},I=h=>{const f=window.tinyMCE.editors[y.value],L=f.selection.getRng(),G=L.startOffset-1;f.selection.setRng({startContainer:L.startContainer,startOffset:h!=null?h:G,endContainer:L.startContainer,endOffset:h!=null?h:G})},z=h=>{if(!h)return[];const f=`([${l.operatorList.map(H=>{var M;return`\\${(M=H.value)!=null?M:H}`}).join("|")}|${l.functionList.map(H=>`\\b${H.label}\\b`).join("|")}\\s])`,L=new RegExp(f),V=h.split(L),G=new RegExp(`[${l.operatorList.map(H=>{var M;return`\\${(M=H.value)!=null?M:H}`}).join("")}]`),q=[];let D=!1,Z="";for(let H=0;H<V.length;H=H+1){const M=V[H];M===""||M===void 0||(M.startsWith("#")?(D=!0,Z=M,M.endsWith("#")&&(q.push({type:"field",value:M}),D=!1,Z="")):D?(Z+=M,M.endsWith("#")&&(q.push({type:"field",value:Z}),D=!1,Z="")):G.test(M)?q.push({type:"text",value:M}):q.push({type:"text",value:M}))}return q},ne=h=>h.map(f=>f.type==="field"?`<span class="mention-field" contenteditable="false">${f.value}</span>`:f.type==="operator"?`<span class="mention-operator">${f.value}</span>`:f.value).join("");return{ztTinymceRef:O,curId:y,content:P,config:W,contentChange:K,initInstanceCallback:A,insertContent:Q,setContent:h=>{P.value=h;const f=z(h),L=ne(f);P.value=L,ge(()=>{window.tinyMCE?B():b=!1})}}}});function tn(l,R,O,y,P,W){const b=se("tinymce");return te(),me(b,{id:l.curId,ref:"ztTinymceRef",modelValue:l.content,"onUpdate:modelValue":R[0]||(R[0]=k=>l.content=k),config:l.config,height:220,width:"100%",class:"tinymce-formula-main",onInitInstanceCallback:l.initInstanceCallback},null,8,["id","modelValue","config","onInitInstanceCallback"])}var nn=Me(en,[["render",tn],["__scopeId","data-v-e73f3a0a"]]);const Ae=l=>(qt("data-v-85990e88"),l=l(),jt(),l),sn=Ae(()=>J("h6",null,"\u5F15\u7528\u5B57\u6BB5",-1)),rn=Ae(()=>J("h6",null,"\u8FD0\u7B97\u7B26",-1)),on={class:"rule-row-content"},an=Ae(()=>J("h6",null,"\u5E38\u7528\u51FD\u6570",-1)),un={__name:"formula-dialog",props:{request:Object,title:{type:String,title:"\u7F16\u8F91\u516C\u5F0F\u89C4\u5219"}},emits:["onClose"],setup(l,{expose:R,emit:O}){const y=l,P=O,W=X(!1),b=X(!1),k=X({calcExpression:null,expressionContent:"",formulaContent:""}),B=X(),K=X(null),g=X(-1),A=X(!1),Q=X(""),I=X({name:""}),z=X(null),ne=/^\s*$/,m=X([]),h=de(()=>{var r,x;return(x=(r=y.request)==null?void 0:r.operatorList)!=null?x:["+","-","*","/","(",")"]}),f=de(()=>{var r,x;return(x=(r=y.request)==null?void 0:r.functionList)!=null?x:[]}),L=de(()=>{const r=[];return m.value.forEach(x=>{x.variableList.forEach(S=>{r.push(S)})}),r}),V=de(()=>{if(Q.value)return Q.value;let r="\u516C\u5F0F\u672A\u68C0\u9A8C";return g.value===0?r="\u516C\u5F0F\u68C0\u9A8C\u4E0D\u901A\u8FC7":g.value===1&&(r="\u516C\u5F0F\u68C0\u9A8C\u901A\u8FC7"),r}),G=de(()=>{let r="info-color no-check";return g.value===0?r="error-color fail-check":g.value===1&&(r="success-color success-check"),r}),q=r=>{r.code!==I.value.code&&z.value.insertContent({value:r.name,type:"field"})},D=r=>{typeof r=="string"?z.value.insertContent({value:r,type:"text"}):z.value.insertContent({...r,type:"text"})},Z=r=>{z.value.insertContent({...r,type:"function"})},H=r=>{let x="",S="";const T=[];console.log("contendEditChange",r),(r||[]).forEach(w=>{if(w.type==="field"){const oe=w.value.replace(/#/g,""),re=L.value.find(ae=>ae.name===oe);re?S+=re.code:S+=w.value,T.push({...w,value:re?re.code:w.value})}else S+=w.value,T.push(w);x+=w.value}),k.value={expressionContent:x,calcExpression:S.replace(/[\u200B-\u200D\uFEFF\s]/g,""),calcList:T},ge(()=>{g.value=-1,Q.value="",B.value.validateField("calcExpression")})},M=()=>(A.value=!0,Q.value="",new Promise((r,x)=>{if(ne.test(k.value.calcExpression)){x("\u8BF7\u8F93\u5165\u516C\u5F0F\u89C4\u5219"),A.value=!1;return}B.value.validate(S=>{var T;S?y.request.checkRule({...(T=y.request.extraParams)!=null?T:{},calcExpression:k.value.calcExpression,calcList:k.value.calcList,code:I.value.code,name:I.value.name,expressionContent:k.value.expressionContent}).then(w=>{w!=null&&w.success?(r(),g.value=1):(g.value=0,Q.value=w.message,x(V.value)),A.value=!1}).catch(w=>{console.log("err",w),g.value=0,A.value=!1,x(V.value)}):(x("\u8BF7\u8F93\u5165\u516C\u5F0F\u89C4\u5219"),A.value=!1)})})),ee=()=>{k.value={},b.value=!1},$=()=>{B.value.validate(r=>{r&&ge(()=>{M().then(()=>{P("change",{...k.value}),ee()}).catch(x=>{console.log("errText",x),Pt.error(x)})})})};return R({open:async r=>{I.value=r,await y.request.queryVariable(I.value).then(x=>{m.value=x}),b.value=!0,k.value={expressionContent:r.expressionContent,calcExpression:r.calcExpression,calcList:r.calcList},K.value=r.variableType,ge(()=>{g.value=-1,Q.value="",B.value.clearValidate();const x=[];r.calcList&&r.calcList.forEach(S=>{if(S.type==="field"){const T=L.value.find(w=>w.code===S.value);T?x.push({type:S.type,value:T.value}):x.push(S)}else x.push(S)}),z.value&&z.value.setContent(r.expressionContent)})}}),(r,x)=>{const S=se("el-form-item"),T=se("el-button"),w=se("el-row"),oe=se("el-form"),re=se("el-divider"),ae=se("el-col"),xe=se("el-dialog");return te(),me(xe,{modelValue:b.value,"onUpdate:modelValue":x[1]||(x[1]=d=>b.value=d),title:l.title,width:"780","close-on-click-modal":!1,onClose:ee},{footer:j(()=>[U(w,{class:"dialog-footer",justify:"end"},{default:j(()=>[J("div",null,[U(T,{type:"primary",loading:W.value,onClick:$},{default:j(()=>[ce(" \u786E\u5B9A ")]),_:1},8,["loading"]),U(T,{onClick:ee},{default:j(()=>[ce("\u53D6\u6D88")]),_:1})])]),_:1})]),default:j(()=>[U(w,{class:"rule-main"},{default:j(()=>[U(ae,{span:16,class:"main-left"},{default:j(()=>[U(oe,{ref_key:"formRef",ref:B,class:"rule-row",model:k.value},{default:j(()=>[J("h6",null,pe(I.value.name)+" =",1),U(S,{label:" ",prop:"calcExpression","label-width":0,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u5F0F\u89C4\u5219"}]},{default:j(()=>[U(nn,{ref_key:"contendEditRef",ref:z,modelValue:k.value.expressionContent,"onUpdate:modelValue":x[0]||(x[0]=d=>k.value.expressionContent=d),operatorList:h.value,functionList:f.value,onChange:H},null,8,["modelValue","operatorList","functionList"])]),_:1}),U(w,null,{default:j(()=>[U(T,{loading:A.value,disabled:ne.test(k.value.calcExpression),onClick:M},{default:j(()=>[ce(" \u6821\u9A8C\u516C\u5F0F ")]),_:1},8,["loading","disabled"]),J("span",{class:qe([G.value,"check-tip-span"])},pe(V.value),3)]),_:1})]),_:1},8,["model"]),U(re),U(w,{class:"rule-row"},{default:j(()=>[sn,(te(!0),le(ye,null,_e(m.value,(d,he)=>(te(),le(ye,null,[!K.value||K.value.includes(d.type)?(te(),le("div",{key:he},[J("p",null,pe(d.type),1),J("div",null,[(te(!0),le(ye,null,_e(d.variableList,(_,Ee)=>(te(),me(T,{key:Ee,disabled:_.code===I.value.code,class:"tag-span",onClick:Te=>q(_)},{default:j(()=>[ce(pe(_.name),1)]),_:2},1032,["disabled","onClick"]))),128))])])):Vt("",!0)],64))),256))]),_:1})]),_:1}),U(ae,{span:8},{default:j(()=>[U(w,{class:"rule-row"},{default:j(()=>[rn,J("div",on,[(te(!0),le(ye,null,_e(h.value,(d,he)=>(te(),me(T,{key:he,class:"tag-span",onClick:_=>D(d)},{default:j(()=>{var _;return[ce(pe((_=d.value)!=null?_:d),1)]}),_:2},1032,["onClick"]))),128))])]),_:1}),U(w,{class:"rule-row"},{default:j(()=>[an,(te(!0),le(ye,null,_e(f.value,(d,he)=>(te(),me(T,{key:he,class:"tag-span",onClick:_=>Z(d)},{default:j(()=>[ce(pe(d==null?void 0:d.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}};var ln=Me(un,[["__scopeId","data-v-85990e88"]]),Ce={exports:{}};(function(l,R){(function(O,y){y(R)})(Ut,function(O){var y="INUMBER",P="IOP1",W="IOP2",b="IOP3",k="IVAR",B="IVARNAME",K="IFUNCALL",g="IFUNDEF",A="IEXPR",Q="IEXPREVAL",I="IMEMBER",z="IENDSTATEMENT",ne="IARRAY";function m(e,t){this.type=e,this.value=t!=null?t:0}function h(e){return new m(P,e)}function f(e){return new m(W,e)}function L(e){return new m(b,e)}function V(e,t,n){var s,i,a,u,E,o,c=[];if(q(e))return D(e,n);for(var C=e.length,p=0;p<C;p++){var v=e[p],Y=v.type;if(Y===y||Y===B)c.push(v.value);else if(Y===W)i=c.pop(),s=c.pop(),v.value==="and"?c.push(!!s&&!!V(i,t,n)):v.value==="or"?c.push(!!s||!!V(i,t,n)):v.value==="="?(u=t.binaryOps[v.value],c.push(u(s,V(i,t,n),n))):(u=t.binaryOps[v.value],c.push(u(D(s,n),D(i,n))));else if(Y===b)a=c.pop(),i=c.pop(),s=c.pop(),v.value==="?"?c.push(V(s?i:a,t,n)):(u=t.ternaryOps[v.value],c.push(u(D(s,n),D(i,n),D(a,n))));else if(Y===k)if(v.value in t.functions)c.push(t.functions[v.value]);else if(v.value in t.unaryOps&&t.parser.isOperatorEnabled(v.value))c.push(t.unaryOps[v.value]);else{var N=n[v.value];if(N===void 0)throw new Error("undefined variable: "+v.value);c.push(N)}else if(Y===P)s=c.pop(),u=t.unaryOps[v.value],c.push(u(D(s,n)));else if(Y===K){for(o=v.value,E=[];0<o--;)E.unshift(D(c.pop(),n));if(!(u=c.pop()).apply||!u.call)throw new Error(u+" is not a function");c.push(u.apply(void 0,E))}else if(Y===g)c.push(function(){for(var ie=c.pop(),ve=[],Ot=v.value;0<Ot--;)ve.unshift(c.pop());function Fe(){for(var Ve=Object.assign({},n),we=0,It=ve.length;we<It;we++)Ve[ve[we]]=arguments[we];return V(ie,t,Ve)}var Pe=c.pop();return Object.defineProperty(Fe,"name",{value:Pe,writable:!1}),n[Pe]=Fe}());else if(Y===A)c.push(G(v,t));else if(Y===Q)c.push(v);else if(Y===I)s=c.pop(),c.push(s[v.value]);else if(Y===z)c.pop();else{if(Y!==ne)throw new Error("invalid Expression");for(o=v.value,E=[];0<o--;)E.unshift(c.pop());c.push(E)}}if(1<c.length)throw new Error("invalid Expression (parity)");return c[0]===0?0:D(c[0],n)}function G(e,t){return q(e)?e:{type:Q,value:function(n){return V(e.value,t,n)}}}function q(e){return e&&e.type===Q}function D(e,t){return q(e)?e.value(t):e}function Z(e,t){for(var n,s,i,a,u,E,o=[],c=0;c<e.length;c++){var C=e[c],p=C.type;if(p===y)typeof C.value=="number"&&C.value<0?o.push("("+C.value+")"):Array.isArray(C.value)?o.push("["+C.value.map(H).join(", ")+"]"):o.push(H(C.value));else if(p===W)s=o.pop(),n=o.pop(),a=C.value,t?a==="^"?o.push("Math.pow("+n+", "+s+")"):a==="and"?o.push("(!!"+n+" && !!"+s+")"):a==="or"?o.push("(!!"+n+" || !!"+s+")"):a==="||"?o.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+n+"),("+s+")))"):a==="=="?o.push("("+n+" === "+s+")"):a==="!="?o.push("("+n+" !== "+s+")"):a==="["?o.push(n+"[("+s+") | 0]"):o.push("("+n+" "+a+" "+s+")"):a==="["?o.push(n+"["+s+"]"):o.push("("+n+" "+a+" "+s+")");else if(p===b){if(i=o.pop(),s=o.pop(),n=o.pop(),(a=C.value)!=="?")throw new Error("invalid Expression");o.push("("+n+" ? "+s+" : "+i+")")}else if(p===k||p===B)o.push(C.value);else if(p===P)n=o.pop(),(a=C.value)==="-"||a==="+"?o.push("("+a+n+")"):t?a==="not"?o.push("(!"+n+")"):a==="!"?o.push("fac("+n+")"):o.push(a+"("+n+")"):a==="!"?o.push("("+n+"!)"):o.push("("+a+" "+n+")");else if(p===K){for(E=C.value,u=[];0<E--;)u.unshift(o.pop());a=o.pop(),o.push(a+"("+u.join(", ")+")")}else if(p===g){for(s=o.pop(),E=C.value,u=[];0<E--;)u.unshift(o.pop());n=o.pop(),t?o.push("("+n+" = function("+u.join(", ")+") { return "+s+" })"):o.push("("+n+"("+u.join(", ")+") = "+s+")")}else if(p===I)n=o.pop(),o.push(n+"."+C.value);else if(p===ne){for(E=C.value,u=[];0<E--;)u.unshift(o.pop());o.push("["+u.join(", ")+"]")}else if(p===A)o.push("("+Z(C.value,t)+")");else if(p!==z)throw new Error("invalid Expression")}return 1<o.length&&(o=t?[o.join(",")]:[o.join(";")]),String(o[0])}function H(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function M(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}function ee(e,t,n){for(var s=!!(n=n||{}).withMembers,i=null,a=0;a<e.length;a++){var u=e[a];u.type===k||u.type===B?s||M(t,u.value)?i=(i!==null&&(M(t,i)||t.push(i)),u.value):t.push(u.value):u.type===I&&s&&i!==null?i+="."+u.value:u.type===A?ee(u.value,t,n):i!==null&&(M(t,i)||t.push(i),i=null)}i===null||M(t,i)||t.push(i)}function $(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}m.prototype.toString=function(){switch(this.type){case y:case P:case W:case b:case k:case B:case z:return this.value;case K:return"CALL "+this.value;case g:return"DEF "+this.value;case ne:return"ARRAY "+this.value;case I:return"."+this.value;default:return"Invalid Instruction"}},$.prototype.simplify=function(e){return e=e||{},new $(function t(n,s,i,a,u){for(var E,o,c,C,p=[],v=[],Y=0;Y<n.length;Y++){var N=n[Y],ie=N.type;if(ie===y||ie===B)Array.isArray(N.value)?p.push.apply(p,t(N.value.map(function(ve){return new m(y,ve)}).concat(new m(ne,N.value.length)),s,i,a,u)):p.push(N);else if(ie===k&&u.hasOwnProperty(N.value))N=new m(y,u[N.value]),p.push(N);else if(ie===W&&1<p.length)o=p.pop(),E=p.pop(),C=i[N.value],N=new m(y,C(E.value,o.value)),p.push(N);else if(ie===b&&2<p.length)c=p.pop(),o=p.pop(),E=p.pop(),N.value==="?"?p.push(E.value?o.value:c.value):(C=a[N.value],N=new m(y,C(E.value,o.value,c.value)),p.push(N));else if(ie===P&&0<p.length)E=p.pop(),C=s[N.value],N=new m(y,C(E.value)),p.push(N);else if(ie===A){for(;0<p.length;)v.push(p.shift());v.push(new m(A,t(N.value,s,i,a,u)))}else if(ie===I&&0<p.length)E=p.pop(),p.push(new m(y,E.value[N.value]));else{for(;0<p.length;)v.push(p.shift());v.push(N)}}for(;0<p.length;)v.push(p.shift());return v}(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},$.prototype.substitute=function(e,t){return t instanceof $||(t=this.parser.parse(String(t))),new $(function n(s,i,a){for(var u=[],E=0;E<s.length;E++){var o=s[E],c=o.type;if(c===k&&o.value===i)for(var C=0;C<a.tokens.length;C++){var p,v=a.tokens[C];p=v.type===P?h(v.value):v.type===W?f(v.value):v.type===b?L(v.value):new m(v.type,v.value),u.push(p)}else c===A?u.push(new m(A,n(o.value,i,a))):u.push(o)}return u}(this.tokens,e,t),this.parser)},$.prototype.evaluate=function(e){return e=e||{},V(this.tokens,this,e)},$.prototype.toString=function(){return Z(this.tokens,!1)},$.prototype.symbols=function(e){e=e||{};var t=[];return ee(this.tokens,t,e),t},$.prototype.variables=function(e){e=e||{};var t=[];ee(this.tokens,t,e);var n=this.functions;return t.filter(function(s){return!(s in n)})},$.prototype.toJSFunction=function(e,t){var n=this,s=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Z(this.simplify(t).tokens,!0)+"; }");return function(){return s.apply(n,arguments)}};var F="TEOF",r="TOP",x="TNUMBER",S="TSTRING",T="TPAREN",w="TBRACKET",oe="TCOMMA",re="TNAME",ae="TSEMICOLON";function xe(e,t,n){this.type=e,this.value=t,this.index=n}function d(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}xe.prototype.toString=function(){return this.type+": "+this.value},d.prototype.newToken=function(e,t,n){return new xe(e,t,n!=null?n:this.pos)},d.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},d.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},d.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(F,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},d.prototype.isString=function(){var e=!1,t=this.pos,n=this.expression.charAt(t);if(n==="'"||n==='"')for(var s=this.expression.indexOf(n,t+1);0<=s&&this.pos<this.expression.length;){if(this.pos=s+1,this.expression.charAt(s-1)!=="\\"){var i=this.expression.substring(t+1,s);this.current=this.newToken(S,this.unescape(i),t),e=!0;break}s=this.expression.indexOf(n,s+1)}return e},d.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return(e==="("||e===")")&&(this.current=this.newToken(T,e),this.pos++,!0)},d.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return!(e!=="["&&e!=="]"||!this.isOperatorEnabled("["))&&(this.current=this.newToken(w,e),this.pos++,!0)},d.prototype.isComma=function(){return this.expression.charAt(this.pos)===","&&(this.current=this.newToken(oe,","),this.pos++,!0)},d.prototype.isSemicolon=function(){return this.expression.charAt(this.pos)===";"&&(this.current=this.newToken(ae,";"),this.pos++,!0)},d.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||n!=="_"&&n!=="."&&(n<"0"||"9"<n)))break}if(e<t){var s=this.expression.substring(e,t);if(s in this.consts)return this.current=this.newToken(x,this.consts[s]),this.pos+=s.length,!0}return!1},d.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||n!=="_"&&(n<"0"||"9"<n)))break}if(e<t){var s=this.expression.substring(e,t);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(r,s),this.pos+=s.length,!0}return!1},d.prototype.isName=function(){for(var e=this.pos,t=e,n=!1;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()){if(t===this.pos&&(s==="$"||s==="_")){s==="_"&&(n=!0);continue}if(t===this.pos||!n||s!=="_"&&(s<"0"||"9"<s))break}else n=!0}if(n){var i=this.expression.substring(e,t);return this.current=this.newToken(re,i),this.pos+=i.length,!0}return!1},d.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);!(t!==" "&&t!=="	"&&t!==`
`&&t!=="\r"||(e=!0,this.pos++,this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var he=/^[0-9a-f]{4}$/i;function _(e,t,n){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=n.allowMemberAccess!==!1}d.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var n=e.substring(0,t);0<=t;){var s=e.charAt(++t);switch(s){case"'":n+="'";break;case'"':n+='"';break;case"\\":n+="\\";break;case"/":n+="/";break;case"b":n+="\b";break;case"f":n+="\f";break;case"n":n+=`
`;break;case"r":n+="\r";break;case"t":n+="	";break;case"u":var i=e.substring(t+1,t+5);he.test(i)||this.parseError("Illegal escape sequence: \\u"+i),n+=String.fromCharCode(parseInt(i,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++t;var a=e.indexOf("\\",t);n+=e.substring(t,a<0?e.length:a),t=a}return n},d.prototype.isComment=function(){return this.expression.charAt(this.pos)==="/"&&this.expression.charAt(this.pos+1)==="*"&&(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0)},d.prototype.isRadixInteger=function(){var e,t,n=this.pos;if(n>=this.expression.length-2||this.expression.charAt(n)!=="0")return!1;if(++n,this.expression.charAt(n)==="x")e=16,t=/^[0-9a-f]$/i,++n;else{if(this.expression.charAt(n)!=="b")return!1;e=2,t=/^[01]$/i,++n}for(var s=!1,i=n;n<this.expression.length;){var a=this.expression.charAt(n);if(!t.test(a))break;n++,s=!0}return s&&(this.current=this.newToken(x,parseInt(this.expression.substring(i,n),e)),this.pos=n),s},d.prototype.isNumber=function(){for(var e,t=!1,n=this.pos,s=n,i=n,a=!1,u=!1;n<this.expression.length&&("0"<=(e=this.expression.charAt(n))&&e<="9"||!a&&e===".");)e==="."?a=!0:u=!0,n++,t=u;if(t&&(i=n),e==="e"||e==="E"){n++;for(var E=!0,o=!1;n<this.expression.length;){if(e=this.expression.charAt(n),!E||e!=="+"&&e!=="-"){if(!("0"<=e&&e<="9"))break;E=!(o=!0)}else E=!1;n++}o||(n=i)}return t?(this.current=this.newToken(x,parseFloat(this.expression.substring(s,n))),this.pos=n):this.pos=i,t},d.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(r,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(r,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(r,">="),this.pos++):this.current=this.newToken(r,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(r,"<="),this.pos++):this.current=this.newToken(r,"<");else if(t==="|"){if(this.expression.charAt(this.pos+1)!=="|")return!1;this.current=this.newToken(r,"||"),this.pos++}else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(r,"=="),this.pos++):this.current=this.newToken(r,t);else{if(t!=="!")return!1;this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(r,"!="),this.pos++):this.current=this.newToken(r,t)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=e,!1)},d.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},d.prototype.getCoordinates=function(){for(var e,t=0,n=-1;t++,e=this.pos-n,0<=(n=this.expression.indexOf(`
`,n+1))&&n<this.pos;);return{line:t,column:e}},d.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)},_.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},_.prototype.tokenMatches=function(e,t){return t===void 0||(Array.isArray(t)?M(t,e.value):typeof t=="function"?t(e):e.value===t)},_.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},_.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},_.prototype.accept=function(e,t){return!(this.nextToken.type!==e||!this.tokenMatches(this.nextToken,t))&&(this.next(),!0)},_.prototype.expect=function(e,t){if(!this.accept(e,t)){var n=this.tokens.getCoordinates();throw new Error("parse error ["+n.line+":"+n.column+"]: Expected "+(t||e))}},_.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;if(this.accept(re)||this.accept(r,function(s){return s.value in t}))e.push(new m(k,this.current.value));else if(this.accept(x))e.push(new m(y,this.current.value));else if(this.accept(S))e.push(new m(y,this.current.value));else if(this.accept(T,"("))this.parseExpression(e),this.expect(T,")");else{if(!this.accept(w,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(w,"]"))e.push(new m(ne,0));else{var n=this.parseArrayList(e);e.push(new m(ne,n))}}},_.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),this.parseUntilEndStatement(e,t)||this.pushExpression(e,t))},_.prototype.pushExpression=function(e,t){for(var n=0,s=t.length;n<s;n++)e.push(t[n])},_.prototype.parseUntilEndStatement=function(e,t){return!!this.accept(ae)&&(!this.nextToken||this.nextToken.type===F||this.nextToken.type===T&&this.nextToken.value===")"||t.push(new m(z)),this.nextToken.type!==F&&this.parseExpression(t),e.push(new m(A,t)),!0)},_.prototype.parseArrayList=function(e){for(var t=0;!this.accept(w,"]");)for(this.parseExpression(e),++t;this.accept(oe);)this.parseExpression(e),++t;return t},_.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(r,"=");){var t=e.pop(),n=[],s=e.length-1;if(t.type!==K){if(t.type!==k&&t.type!==I)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(n),e.push(new m(B,t.value)),e.push(new m(A,n)),e.push(f("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var i=0,a=t.value+1;i<a;i++){var u=s-i;e[u].type===k&&(e[u]=new m(B,e[u].value))}this.parseVariableAssignmentExpression(n),e.push(new m(A,n)),e.push(new m(g,t.value))}}},_.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(r,"?");){var t=[],n=[];this.parseConditionalExpression(t),this.expect(r,":"),this.parseConditionalExpression(n),e.push(new m(A,t)),e.push(new m(A,n)),e.push(L("?"))}},_.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(r,"or");){var t=[];this.parseAndExpression(t),e.push(new m(A,t)),e.push(f("or"))}},_.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(r,"and");){var t=[];this.parseComparison(t),e.push(new m(A,t)),e.push(f("and"))}};var Ee=["==","!=","<","<=",">=",">","in"];_.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(r,Ee);){var t=this.current;this.parseAddSub(e),e.push(f(t.value))}};var Te=["+","-","||"];_.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(r,Te);){var t=this.current;this.parseTerm(e),e.push(f(t.value))}};var je=["*","/","%"];function Ue(e,t){return Number(e)+Number(t)}function Be(e,t){return e-t}function ze(e,t){return e*t}function De(e,t){return e/t}function He(e,t){return e%t}function We(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function Xe(e,t){return e===t}function Ge(e,t){return e!==t}function Ye(e,t){return t<e}function Je(e,t){return e<t}function Ke(e,t){return t<=e}function Qe(e,t){return e<=t}function Ze(e,t){return Boolean(e&&t)}function et(e,t){return Boolean(e||t)}function tt(e,t){return M(t,e)}function nt(e){return(Math.exp(e)-Math.exp(-e))/2}function st(e){return(Math.exp(e)+Math.exp(-e))/2}function rt(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function it(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function ot(e){return Math.log(e+Math.sqrt(e*e-1))}function at(e){return Math.log((1+e)/(1-e))/2}function Se(e){return Math.log(e)*Math.LOG10E}function ut(e){return-e}function lt(e){return!e}function ct(e){return e<0?Math.ceil(e):Math.floor(e)}function pt(e){return Math.random()*(e||1)}function Oe(e){return ke(e+1)}_.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(r,je);){var t=this.current;this.parseFactor(e),e.push(f(t.value))}},_.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;if(this.save(),this.accept(r,function(s){return s.value in t})){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===T&&this.nextToken.value==="(")return this.restore(),void this.parseExponential(e);if(this.nextToken.type===ae||this.nextToken.type===oe||this.nextToken.type===F||this.nextToken.type===T&&this.nextToken.value===")")return this.restore(),void this.parseAtom(e)}var n=this.current;this.parseFactor(e),e.push(h(n.value))}else this.parseExponential(e)},_.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(r,"^");)this.parseFactor(e),e.push(f("^"))},_.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(r,"!");)e.push(h("!"))},_.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;if(this.accept(r,function(i){return i.value in t})){var n=this.current;this.parseAtom(e),e.push(h(n.value))}else for(this.parseMemberExpression(e);this.accept(T,"(");)if(this.accept(T,")"))e.push(new m(K,0));else{var s=this.parseArgumentList(e);e.push(new m(K,s))}},_.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(T,")");)for(this.parseExpression(e),++t;this.accept(oe);)this.parseExpression(e),++t;return t},_.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(r,".")||this.accept(w,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(re),e.push(new m(I,this.current.value))}else{if(t.value!=="[")throw new Error("unexpected symbol: "+t.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(w,"]"),e.push(f("["))}}};var ht=4.7421875,be=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function ke(e){var t,n;if(function(C){return isFinite(C)&&C===Math.round(C)}(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(171<e)return 1/0;for(var s=e-2,i=e-1;1<s;)i*=s,s--;return i===0&&(i=1),i}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*ke(1-e));if(171.35<=e)return 1/0;if(85<e){var a=e*e,u=a*e,E=u*e,o=E*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*a)-139/(51840*u)-571/(2488320*E)+163879/(209018880*o)+5246819/(75246796800*o*e))}--e,n=be[0];for(var c=1;c<be.length;++c)n+=be[c]/(e+c);return t=e+ht+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*n}function ft(e){return Array.isArray(e)?e.length:String(e).length}function Ie(){for(var e=0,t=0,n=0;n<arguments.length;n++){var s,i=Math.abs(arguments[n]);t<i?(e=e*(s=t/i)*s+1,t=i):e+=0<i?(s=i/t)*s:i}return t===1/0?1/0:t*Math.sqrt(e)}function Ne(e,t,n){return e?t:n}function dt(e,t){return t===void 0||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||typeof t!="number"||t%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+t:t))))}function vt(e,t,n){return n&&(n[e]=t),t}function yt(e,t){return e[0|t]}function mt(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function gt(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function xt(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(n,s){return e(n,s)})}function wt(e,t,n){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(n))throw new Error("Second argument to fold is not an array");return n.reduce(function(s,i,a){return e(s,i,a)},t)}function _t(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(n,s){return e(n,s)})}function Et(e,t){if(!Array.isArray(t)&&typeof t!="string")throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function bt(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function kt(e){return(0<e)-(e<0)||+e}var Le=1/3;function Ct(e){return e<0?-Math.pow(-e,Le):Math.pow(e,Le)}function Mt(e){return Math.exp(e)-1}function At(e){return Math.log(1+e)}function Tt(e){return Math.log(e)/Math.LN2}function ue(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||nt,cosh:Math.cosh||st,tanh:Math.tanh||rt,asinh:Math.asinh||it,acosh:Math.acosh||ot,atanh:Math.atanh||at,sqrt:Math.sqrt,cbrt:Math.cbrt||Ct,log:Math.log,log2:Math.log2||Tt,ln:Math.log,lg:Math.log10||Se,log10:Math.log10||Se,expm1:Math.expm1||Mt,log1p:Math.log1p||At,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ct,"-":ut,"+":Number,exp:Math.exp,not:lt,length:ft,"!":Oe,sign:Math.sign||kt},this.binaryOps={"+":Ue,"-":Be,"*":ze,"/":De,"%":He,"^":Math.pow,"||":We,"==":Xe,"!=":Ge,">":Ye,"<":Je,">=":Ke,"<=":Qe,and:Ze,or:et,in:tt,"=":vt,"[":yt},this.ternaryOps={"?":Ne},this.functions={random:pt,fac:Oe,min:gt,max:mt,hypot:Math.hypot||Ie,pyt:Math.hypot||Ie,pow:Math.pow,atan2:Math.atan2,if:Ne,gamma:ke,roundTo:dt,map:xt,fold:wt,filter:_t,indexOf:Et,join:bt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}ue.prototype.parse=function(e){var t=[],n=new _(this,new d(this,e),{allowMemberAccess:this.options.allowMemberAccess});return n.parseExpression(t),n.expect(F,"EOF"),new $(t,this)},ue.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var Re=new ue;ue.parse=function(e){return Re.parse(e)},ue.evaluate=function(e,t){return Re.parse(e).evaluate(t)};var $e={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};ue.prototype.isOperatorEnabled=function(e){var t=function(s){return $e.hasOwnProperty(s)?$e[s]:s}(e),n=this.options.operators||{};return!(t in n&&!n[t])};var St={Parser:ue,Expression:$};O.Expression=$,O.Parser=ue,O.default=St,Object.defineProperty(O,"__esModule",{value:!0})})})(Ce,Ce.exports);const cn={class:"index-page"},pn=J("h3",null,"\u6B22\u8FCE\u4F7F\u7528\u4E1A\u52A1\u89C4\u5219\u516C\u5F0F\u7F16\u8F91\u5668",-1),hn=J("p",{style:{margin:"16px 0"}},"\u516C\u5F0F\u89C4\u5219:",-1),fn={class:"content"},dn=J("p",{style:{margin:"16px 0"}},"\u5B9E\u9645\u516C\u5F0F\u89C4\u5219:",-1),vn={class:"content"},gn={__name:"index",setup(l){const R=X([{type:"\u8425\u4E1A\u4F53\u7CFB",variableList:[{code:"MAIN_BUSINESS_INCOME",name:"\u4E3B\u8425\u4E1A\u52A1\u6536\u5165"},{code:"MATERIAL_SALES_INCOME",name:"\u6750\u6599\u9500\u552E\u6536\u5165"},{code:"OTHER_BUSINESS_INCOME",name:"\u5176\u4ED6\u4E1A\u52A1\u6536\u5165"},{code:"MAIN_BUSINESS_COST",name:"\u4E3B\u8425\u4E1A\u52A1\u6210\u672C"},{code:"BUSINESS_TAX_SURCHARGE",name:"\u8425\u4E1A\u7A0E\u91D1\u53CA\u9644\u52A0"},{code:"OPERATING_EXPENSES",name:"\u8425\u4E1A\u8D39\u7528"}]},{type:"\u8D44\u4EA7\u8FD0\u8425",variableList:[{code:"SELLING_EXPENSES",name:"\u9500\u552E\u8D39\u7528"},{code:"FINANCIAL_EXPENSES",name:"\u8D22\u52A1\u8D39\u7528"},{code:"INVESTMENT_INCOME",name:"\u6295\u8D44\u6536\u76CA"},{code:"ASSET_IMPAIRMENT_LOSS",name:"\u8D44\u4EA7\u51CF\u503C\u635F\u5931"}]},{type:"\u5176\u4ED6",variableList:[{code:"OTHER_BUSINESS_COST",name:"\u5176\u4ED6\u4E1A\u52A1\u6210\u672C"}]},{type:"\u7CFB\u6570",variableList:[{code:"PERFORMANCE_COEFFICIENT",name:"\u7EE9\u6548\u7CFB\u6570"},{code:"ANNUAL",name:"\u5E74\u5EA6"},{code:"QUARTERLY",name:"\u5B63\u5EA6"},{code:"MONTHLY",name:"\u6708\u5EA6"}]}]),O=X({expressionContent:"#\u4E3B\u8425\u4E1A\u52A1\u6536\u5165#+#\u6750\u6599\u9500\u552E\u6536\u5165#",calcExpression:"MAIN_BUSINESS_INCOME+MATERIAL_SALES_INCOME"}),y=X(null),P=X([{label:"AND",value:"AND",fn:"==",offsetIdx:0},{label:"OR",value:"OR",fn:"||",offsetIdx:0},{label:"IF",value:["IF(",")"],fn:g=>g||""},{label:"HALT",value:['HALT("','", , )'],fn:g=>g||""}]),W=new Ce.exports.Parser,b=g=>new Promise((A,Q)=>{g.calcList.forEach(z=>{z.type==="field"&&(W.consts[z.value]=1)});const I=W.evaluate(g.calcExpression);return(I!==null||I===void 0)&&A({success:!0,message:"\u516C\u5F0F\u6821\u9A8C\u901A\u8FC7"}),I}),k=()=>new Promise(g=>{g(R.value)}),B=()=>{const g={name:"\u8425\u4E1A\u5229\u6DA6",code:""};y.value.open({...g,...O.value})},K=g=>{g&&(O.value.expressionContent=g.expressionContent,O.value.calcExpression=g.calcExpression)};return(g,A)=>{const Q=se("el-icon"),I=se("el-button"),z=se("el-row");return te(),le("div",cn,[pn,J("div",null,[hn,J("div",fn,[ce(pe(O.value.expressionContent)+" ",1),U(I,{type:"",link:"",title:"\u7F16\u8F91",onClick:B},{default:j(()=>[U(Q,null,{default:j(()=>[U(Bt(zt))]),_:1})]),_:1})]),dn,J("div",vn,pe(O.value.calcExpression),1),U(I,{type:"primary",onClick:B},{default:j(()=>[ce("\u7F16\u8F91\u89C4\u5219")]),_:1})]),U(z),U(ln,{ref_key:"formulaRulesRef",ref:y,title:"\u7F16\u8F91\u516C\u5F0F\u89C4\u5219",request:{queryVariable:k,checkRule:b,functionList:P.value},onChange:K},null,8,["request"])])}}};export{gn as default};
